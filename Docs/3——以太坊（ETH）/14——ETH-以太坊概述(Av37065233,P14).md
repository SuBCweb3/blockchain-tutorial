**14-ETH-以太坊概述优化版 (Av37065233, P14.2)**

## 以太坊简介

比特币和以太坊是两种最主要的加密货币。比特币被称为区块链 1.0，以太坊被称为区块链 2.0。

### 区块链发展历程

```mermaid
timeline
    title 区块链技术发展路线图
    
    2008 : 比特币白皮书发布
         : 中本聪提出区块链概念
    
    2009 : 比特币网络上线
         : 区块链 1.0 时代开始
    
    2013 : 以太坊白皮书发布
         : Vitalik Buterin提出智能合约概念
    
    2015 : 以太坊主网上线
         : 区块链 2.0 时代到来
    
    未来 : 权益证明转换
         : 区块链 3.0 演进
```

### 比特币与以太坊核心对比

| 特性 | 比特币 (BTC) | 以太坊 (ETH) |
|------|-------------|-------------|
| 发布时间 | 2009年 | 2015年 |
| 技术代际 | 区块链 1.0 | 区块链 2.0 |
| 主要用途 | 数字货币 | 智能合约平台 |
| 出块时间 | 10分钟 | 10几秒 |
| 共识机制 | 工作量证明 | 工作量证明 → 权益证明 |
| 货币符号 | BTC | ETH |
| 最小单位 | 1聪 | 1Wei |

## 以太坊的系统改进

以太坊在系统设计上，针对比特币运行过程中出现的一些问题进行了改进：

### 1. 出块时间优化

- **比特币**：出块时间为 10 分钟
- **以太坊**：出块时间大幅降低到 10 几秒

#### 出块时间对比可视化

```mermaid
graph LR
    subgraph "比特币网络"
        A1[区块1] -->|10分钟| A2[区块2]
        A2 -->|10分钟| A3[区块3]
        A3 -->|10分钟| A4[区块4]
    end
    
    subgraph "以太坊网络"
        B1[区块1] -->|~15秒| B2[区块2]
        B2 -->|~15秒| B3[区块3]
        B3 -->|~15秒| B4[区块4]
        B4 -->|~15秒| B5[区块5]
        B5 -->|~15秒| B6[区块6]
        B6 -->|~15秒| B7[区块7]
        B7 -->|~15秒| B8[区块8]
        B8 -->|~15秒| B9[区块9]
        B9 -->|~15秒| B10[区块10]
        B10 -->|~15秒| B11[区块11]
        B11 -->|~15秒| B12[区块12]
        B12 -->|~15秒| B13[区块13]
        B13 -->|~15秒| B14[区块14]
        B14 -->|~15秒| B15[区块15]
        B15 -->|~15秒| B16[区块16]
        B16 -->|~15秒| B17[区块17]
        B17 -->|~15秒| B18[区块18]
        B18 -->|~15秒| B19[区块19]
        B19 -->|~15秒| B20[区块20]
        B20 -->|~15秒| B21[区块21]
        B21 -->|~15秒| B22[区块22]
        B22 -->|~15秒| B23[区块23]
        B23 -->|~15秒| B24[区块24]
        B24 -->|~15秒| B25[区块25]
        B25 -->|~15秒| B26[区块26]
        B26 -->|~15秒| B27[区块27]
        B27 -->|~15秒| B28[区块28]
        B28 -->|~15秒| B29[区块29]
        B29 -->|~15秒| B30[区块30]
        B30 -->|~15秒| B31[区块31]
        B31 -->|~15秒| B32[区块32]
        B32 -->|~15秒| B33[区块33]
        B33 -->|~15秒| B34[区块34]
        B34 -->|~15秒| B35[区块35]
        B35 -->|~15秒| B36[区块36]
        B36 -->|~15秒| B37[区块37]
        B37 -->|~15秒| B38[区块38]
        B38 -->|~15秒| B39[区块39]
        B39 -->|~15秒| B40[区块40]
    end
    
    style A1 fill:#f9f,stroke:#333,stroke-width:2px
    style B1 fill:#bbf,stroke:#333,stroke-width:2px
```

*注：在相同30分钟内，比特币产生3个区块，以太坊产生约120个区块*

#### 性能提升对比

| 性能指标 | 比特币 | 以太坊 | 改进倍数 |
|---------|--------|--------|----------|
| 出块时间 | 10分钟 | 15秒 | 约40倍提升 |
| 交易吞吐量 | 3-7 TPS | 15-25 TPS | 约4倍提升 |
| 确认时间 | 60分钟 | 5分钟 | 约12倍提升 |

很多人觉得比特币的出块时间太长，影响了系统的 throughput，也影响了响应时间。为了适应这种新的出块时间，以太坊设计了一套基于 GHOST 协议的共识机制。

### 2. 挖矿算法改进

比特币的 mining puzzle 是计算密集型的，比拼的是计算哈希值的算力。这造成了挖矿设备专业化的结果：

- 很多年以前，用普通桌面机挖矿就已经无利可图
- 现在大家用的清一色都是 ASIC 芯片的矿机

#### 挖矿设备演进历程

```mermaid
graph TD
    A[CPU挖矿时代] --> B[GPU挖矿时代]
    B --> C[FPGA挖矿时代]
    C --> D[ASIC挖矿时代]
    
    A1[个人电脑<br/>2009-2010] --> A
    B1[显卡挖矿<br/>2010-2012] --> B
    C1[专业矿机<br/>2012-2013] --> C
    D1[ASIC矿机<br/>2013至今] --> D
    
    subgraph "算力对比"
        E[CPU: 几十MH/s]
        F[GPU: 几百MH/s]
        G[FPGA: 几GH/s]
        H[ASIC: 几TH/s]
    end
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fce4ec
```

#### 挖矿算法对比分析

| 算法特征 | 比特币 SHA-256 | 以太坊 Ethash |
|---------|---------------|---------------|
| 算法类型 | 计算密集型 | 内存密集型 |
| 主要资源需求 | 算力（Hash/s） | 内存（Memory） |
| ASIC抗性 | 无 | 有 |
| 设备民主化 | 低 | 相对较高 |
| 专业化程度 | 极高 | 中等 |

很多人认为这种做法与当初区块链所宣扬的去中心化理念不符。

**以太坊的解决方案**：

以太坊设计的 mining puzzle 对内存的要求很高，叫做 **Memory Hard Mining Puzzle**。这样设计的目的是在一定程度上限制 ASIC 芯片的使用，我们管它叫做 **ASIC Resistance**。

#### ASIC抗性原理图

```mermaid
graph TB
    subgraph "传统计算密集型算法"
        A1[ASIC芯片]
        A2[极强算力]
        A3[巨大优势]
        A1 --> A2 --> A3
    end
    
    subgraph "内存密集型算法"
        B1[ASIC芯片]
        B2[有限内存优势]
        B3[优势较小]
        B1 --> B2 --> B3
        
        C1[普通GPU]
        C2[充足内存]
        C3[竞争优势]
        C1 --> C2 --> C3
    end
    
    style A3 fill:#ffcdd2
    style B3 fill:#fff3e0
    style C3 fill:#e8f5e8
```

### 3. 未来的革命性改变

将来以太坊还有更加革命性的改变——用权益证明（Proof of Stake）替代工作量证明（Proof of Work）。

#### 共识机制演进路线图

```mermaid
graph LR
    A[工作量证明<br/>Proof of Work] -->|以太坊2.0升级| B[权益证明<br/>Proof of Stake]
    
    subgraph "PoW特征"
        A1[挖矿竞争]
        A2[能耗巨大]
        A3[算力决定]
    end
    
    subgraph "PoS特征"
        B1[质押投票]
        B2[节能环保]
        B3[持币比例决定]
    end
    
    A --> A1
    A --> A2
    A --> A3
    
    B --> B1
    B --> B2
    B --> B3
    
    style A fill:#ffcdd2
    style B fill:#e8f5e8
```

#### 共识机制对比

| 特征 | 工作量证明 (PoW) | 权益证明 (PoS) |
|------|------------------|----------------|
| 选择机制 | 算力竞争 | 质押投票 |
| 能源消耗 | 极高 | 极低 |
| 硬件要求 | 专业矿机 | 普通服务器 |
| 准入门槛 | 硬件投资 | 代币质押 |
| 安全模型 | 经济激励 | 经济激励 + 惩罚 |

- **Proof of Work**：工作量证明，通俗来说就是挖矿。为了发布区块，你需要做很多工作
- **Proof of Stake**：权益证明，不再挖矿，而是按照类似股份投票的方法决定下一个区块如何产生

## 智能合约的引入

除了系统设计的改变，以太坊还增加了一个重要功能：对智能合约（Smart Contract）的支持。

### 什么是智能合约？

比特币实现的是一种去中心化的货币。比特币成功后，很多人思考一个问题：

> **If we can decentralize currency, what else can we decentralize?**  
> 如果货币可以去中心化，还有什么可以去中心化？

#### 去中心化演进过程

```mermaid
graph TD
    A[中心化系统] --> B[去中心化货币]
    B --> C[去中心化合约]
    C --> D[去中心化应用]
    
    A1[传统银行系统] --> A
    B1[比特币<br/>区块链1.0] --> B
    C1[以太坊智能合约<br/>区块链2.0] --> C
    D1[DeFi, NFT, DAO<br/>区块链3.0] --> D
    
    style A fill:#ffcdd2
    style B fill:#fff3e0
    style C fill:#e8f5e8
    style D fill:#e3f2fd
```

以太坊的特性就是增加了去中心化合约的支持。

### 货币符号和计量单位

#### 货币体系对比

| 项目 | 比特币 | 以太坊 |
|------|--------|--------|
| 货币符号 | BTC | ETH |
| 货币名称 | 比特币 | 以太/以太币 |
| 最小单位 | 1 聪 (Satoshi) | 1 Wei |
| 单位换算 | 1 BTC = 10⁸ 聪 | 1 ETH = 10¹⁸ Wei |
| 纪念人物 | 中本聪 | Wei Dai |

- **比特币**：符号为 BTC，最小单位为 1 聪（为纪念中本聪）
- **以太坊**：符号为 ETH，货币通常称为「以太」或「以太币」，最小单位为 1 Wei（人名）

#### 以太坊货币单位层次结构

```mermaid
graph TD
    A[1 Ether] --> B[1,000 Finney]
    B --> C[1,000,000 Szabo]
    C --> D[1,000,000,000 Gwei]
    D --> E[1,000,000,000,000,000,000 Wei]
    
    style A fill:#e3f2fd
    style E fill:#f3e5f5
```

## 去中心化合约的原理

### 传统合约体系

现实社会中，合约的有效性通过司法手段和政府来维护：

#### 传统合约执行流程

```mermaid
graph TD
    A[合约签署] --> B[合约执行]
    B --> C{是否出现纠纷?}
    C -->|是| D[起诉对方]
    C -->|否| E[合约完成]
    D --> F[法院受理]
    F --> G[检查签名合法性]
    G --> H[判决违约方]
    H --> I[执行处罚]
    I --> J[合约结束]
    
    style A fill:#e8f5e8
    style E fill:#e8f5e8
    style D fill:#ffcdd2
    style I fill:#fff3e0
```

1. 签署合同
2. 出现纠纷时通过打官司、法院判决
3. 法院检查合同签名的合法性
4. 确定违约方和处罚方式

### 智能合约的技术替代

智能合约的设计目的是用技术手段替代司法手段：

#### 智能合约执行流程

```mermaid
graph TD
    A[编写智能合约] --> B[部署到区块链]
    B --> C[合约自动执行]
    C --> D{条件是否满足?}
    D -->|是| E[自动执行相应操作]
    D -->|否| F[等待条件满足]
    F --> D
    E --> G[合约完成]
    
    H[区块链保证] --> I[代码不可篡改]
    I --> J[执行结果确定]
    
    style A fill:#e3f2fd
    style B fill:#e8f5e8
    style E fill:#e8f5e8
    style G fill:#e8f5e8
    style I fill:#fff3e0
```

#### 传统合约 vs 智能合约对比

| 特征 | 传统合约 | 智能合约 |
|------|----------|----------|
| 执行方式 | 人工执行 | 自动执行 |
| 争议解决 | 司法仲裁 | 代码逻辑 |
| 信任基础 | 法律系统 | 区块链技术 |
| 执行成本 | 高（律师费、时间成本） | 低（Gas费） |
| 执行速度 | 慢（可能需要数月） | 快（几分钟到几小时） |
| 适用范围 | 所有合约 | 可编程合约 |

- 如果合同内容可以通过程序代码实现，就将代码放到区块链上
- 通过区块链的不可篡改性保证代码的正确运行
- 当然，不是所有合同内容都可以用编程语言实现，也不是所有合同条款都可以量化
- 但逻辑简单、清晰的合同可以写成智能合约形式

## 去中心化合约的应用场景

### 1. 跨国场景

**类比去中心化货币的优势**：
- 跨国转账：从美国转账到埃及，用法币很麻烦（时间长、手续多、费用高）
- 用比特币转账相对更快捷

#### 跨国合约场景对比

```mermaid
graph TD
    subgraph "传统跨国合约"
        A1[美国公司] --> A2[签署合约]
        A3[埃及公司] --> A2
        A2 --> A4[选择管辖法院]
        A4 --> A5[可能的争议]
        A5 --> A6[复杂的国际仲裁]
        A6 --> A7[执行困难]
    end
    
    subgraph "智能合约"
        B1[美国公司] --> B2[部署智能合约]
        B3[埃及公司] --> B2
        B2 --> B4[区块链自动执行]
        B4 --> B5[条件满足即执行]
        B5 --> B6[无需仲裁]
    end
    
    style A6 fill:#ffcdd2
    style A7 fill:#ffcdd2
    style B4 fill:#e8f5e8
    style B5 fill:#e8f5e8
```

**智能合约的类似应用**：
- 合同签署方来自世界各地，没有统一的司法管辖权
- 例如：网上众筹项目，参与方遍布全球，彼此不认识
- 通过预先编写的程序代码保证每个人只能按规则执行

#### 众筹智能合约示例

```mermaid
graph TD
    A[项目方发起众筹] --> B[部署众筹合约]
    B --> C[全球投资者参与]
    C --> D{筹资目标是否达成?}
    D -->|是| E[自动转账给项目方]
    D -->|否| F[自动退款给投资者]
    E --> G[项目启动]
    F --> H[众筹失败]
    
    style E fill:#e8f5e8
    style F fill:#e8f5e8
    style G fill:#e8f5e8
```

### 2. 本地场景的优势

即使合同参与方在同一司法管辖权下，通过司法手段维护合同执行也是费时费力的过程：

#### 传统合约纠纷解决流程分析

```mermaid
graph TD
    A[合约纠纷] --> B[寻找律师]
    B --> C[准备证据材料]
    C --> D[起诉对方]
    D --> E[法院受理]
    E --> F[开庭审理]
    F --> G[判决结果]
    G --> H[申请执行]
    H --> I{对方是否有资产?}
    I -->|是| J[强制执行]
    I -->|否| K[无法执行]
    J --> L[拿到赔偿]
    K --> M[败诉方无力赔偿]
    
    N[时间成本：6个月-2年]
    O[金钱成本：律师费+诉讼费]
    P[不确定性：可能败诉或无法执行]
    
    style K fill:#ffcdd2
    style M fill:#ffcdd2
    style N fill:#fff3e0
    style O fill:#fff3e0
    style P fill:#fff3e0
```

- 打官司需要大量时间和精力
- 即使官司胜诉，也不一定能拿到钱
- 需要申请冻结对方资产、申请强制执行等

#### 智能合约优势总结

```mermaid
graph TD
    A[智能合约优势] --> B[技术保证]
    A --> C[自动执行]
    A --> D[不可篡改]
    A --> E[低成本]
    
    B --> B1[代码逻辑确定]
    B --> B2[区块链保证]
    
    C --> C1[条件满足即执行]
    C --> C2[无需人工干预]
    
    D --> D1[代码不可修改]
    D --> D2[执行结果确定]
    
    E --> E1[无需律师费]
    E --> E2[无需诉讼费]
    
    style B fill:#e8f5e8
    style C fill:#e8f5e8
    style D fill:#e8f5e8
    style E fill:#e8f5e8
```

**智能合约的优势**：
- 用技术手段保证合同参与方从一开始就不可能违约
- 代码一旦发布到区块链上，区块链的不可篡改性确保谁也改不了代码
- 包括代码作者自己也无法修改
- 保证大家只能按照代码中制定的规则执行

## 后续将了解一下内容：

### 学习路线图

```mermaid
graph TD
    A[以太坊概述] --> B[数据结构和共识机制]
    B --> C[挖矿算法]
    C --> D[智能合约详解]
    
    C1[工作量证明<br/>Proof of Work] --> C
    C2[权益证明<br/>Proof of Stake] --> C
    
    D1[Solidity语言] --> D
    D2[DApp开发] --> D
    D3[DeFi应用] --> D
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
```

1. **以太坊的数据结构和共识机制**
2. **挖矿算法**
   - 现在使用的工作量证明（Proof of Work）
   - 未来将使用的权益证明（Proof of Stake）
3. **智能合约详解**